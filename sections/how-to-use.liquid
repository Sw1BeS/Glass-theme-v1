{% comment %}
  How to Use Section - Chess layout with creative step transitions
  Features: Alternating layout, animated connectors, step indicators
{% endcomment %}

{% liquid
  assign steps = section.blocks | where: 'type', 'step'
  assign step_count = steps.size
%}

<div class="how-to-use-section color-{{ section.settings.color_scheme }}" style="{% render 'spacing-style', settings: section.settings %}">
  <div class="how-to-use-container">
    <div class="how-to-use-header">
      {%- assign header_found = false -%}
      {%- for block in section.blocks -%}
        {%- if block.type == 'section_header' -%}
          <h2 class="how-to-use-title">{{ block.settings.heading | default: 'How to Use' }}</h2>
          {%- if block.settings.subheading != blank -%}
            <p class="how-to-use-subtitle">{{ block.settings.subheading }}</p>
          {%- endif -%}
          {%- assign header_found = true -%}
          {%- break -%}
        {%- endif -%}
      {%- endfor -%}
      {%- unless header_found -%}
        <h2 class="how-to-use-title">{{ section.settings.section_heading | default: 'How to Use' }}</h2>
        <p class="how-to-use-subtitle">{{ section.settings.section_subheading | default: 'Follow these simple steps for perfect results' }}</p>
      {%- endunless -%}
    </div>

    <div class="how-to-use-steps" data-step-count="{{ step_count }}">
      {%- for block in steps -%}
        {%- assign step_index = forloop.index -%}
        {%- assign is_even = forloop.index | modulo: 2 -%}

        <div
          class="how-to-step {% if is_even == 0 %}step-reverse{% else %}step-normal{% endif %} glass"
          data-step="{{ step_index }}"
          data-aos="fade-up"
          data-aos-delay="{{ forloop.index0 | times: 200 }}"
          {{ block.shopify_attributes }}
        >
          <!-- Step Number with Progress Line -->
          <div class="step-progress-wrapper">
            <div class="step-number">
              <span class="step-number-text">{{ step_index }}</span>
              <div class="step-number-bg"></div>
            </div>
            {%- unless forloop.last -%}
              <div class="step-progress-line">
                <div class="progress-line-fill"></div>
                <div class="progress-dots">
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                </div>
              </div>
            {%- endunless -%}
          </div>

          <!-- Step Content -->
          <div class="step-content">
            <div class="step-image-wrapper">
              {%- if block.settings.image != blank -%}
                <div class="step-image-container">
                  <!-- Desktop Image -->
                  <div class="step-image-desktop">
                    {{
                      block.settings.image
                      | image_url: width: 600
                      | image_tag:
                        loading: 'lazy',
                        sizes: '(min-width: 768px) 400px, 0px',
                        widths: '400, 500, 600',
                        class: 'step-image'
                    }}
                  </div>

                  <!-- Mobile Image -->
                  {%- if block.settings.image_mobile != blank -%}
                    <div class="step-image-mobile">
                      {{
                        block.settings.image_mobile
                        | image_url: width: 400
                        | image_tag:
                          loading: 'lazy',
                          sizes: '(max-width: 767px) 300px, 0px',
                          widths: '300, 400',
                          class: 'step-image'
                      }}
                    </div>
                  {%- else -%}
                    <!-- Fallback to desktop image for mobile -->
                    <div class="step-image-mobile">
                      {{
                        block.settings.image
                        | image_url: width: 400
                        | image_tag:
                          loading: 'lazy',
                          sizes: '(max-width: 767px) 300px, 0px',
                          widths: '300, 400',
                          class: 'step-image'
                      }}
                    </div>
                  {%- endif -%}

                  <div class="image-overlay"></div>
                </div>
              {%- else -%}
                <div class="step-placeholder">
                  <div class="placeholder-content">
                    <div class="placeholder-icon">{{ block.settings.icon | default: 'üì∏' }}</div>
                    <h4 class="placeholder-title">
                      {{
                        block.settings.placeholder_title
                        | default: 'Add Step '
                        | append: step_index
                        | append: ' Image'
                      }}
                    </h4>
                    <div class="placeholder-specs">
                      <div class="spec-item">
                        <span class="spec-label">üåê Web:</span>
                        <span class="spec-value">{{ block.settings.placeholder_web_size | default: '800√ó600px' }}</span>
                      </div>
                      <div class="spec-item">
                        <span class="spec-label">üì± Mobile:</span>
                        <span class="spec-value">
                          {{- block.settings.placeholder_mobile_size | default: '600√ó400px' -}}
                        </span>
                      </div>
                      <div class="spec-item spec-creative">
                        <span class="spec-label">üí° Tip:</span>
                        <span class="spec-value">
                          {{-
                            block.settings.placeholder_creative
                            | default: 'Tutorial step showing beauty product application technique'
                          -}}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              {%- endif -%}
            </div>

            <div class="step-text-wrapper">
              {%- if block.settings.heading != blank -%}
                <h3 class="step-heading">{{ block.settings.heading }}</h3>
              {%- endif -%}

              {%- if block.settings.text != blank -%}
                <div class="step-description">{{ block.settings.text }}</div>
              {%- endif -%}

              {%- if block.settings.tip != blank -%}
                <div class="step-tip">
                  <div class="tip-icon">üí°</div>
                  <p class="tip-text">{{ block.settings.tip }}</p>
                </div>
              {%- endif -%}

              {%- if block.settings.duration != blank -%}
                <div class="step-duration">
                  <div class="duration-icon">‚è±Ô∏è</div>
                  <span class="duration-text">{{ block.settings.duration }}</span>
                </div>
              {%- endif -%}
            </div>
          </div>

          <!-- Decorative Elements -->
          <div class="step-decorations">
            <div class="decoration-circle decoration-1"></div>
            <div class="decoration-circle decoration-2"></div>
            <div class="decoration-line"></div>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

{% stylesheet %}
  .how-to-use-section {
    padding: clamp(3.5rem, 6vw, 5rem) 0;
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var(--color-background, #ffffff) 88%, transparent) 0%,
      color-mix(in srgb, var(--color-secondary-bg, #f5f2eb) 82%, transparent) 100%
    );
    position: relative;
    overflow: hidden;
    width: 100vw;
    margin-left: calc(-50vw + 50%);
  }

  .how-to-use-container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 clamp(1.5rem, 4vw, 2.5rem);
    display: grid;
    gap: clamp(2.5rem, 5vw, 4rem);
  }

  .how-to-use-header {
    text-align: center;
    display: grid;
    gap: clamp(0.75rem, 2vw, 1.2rem);
    position: relative;
  }

  .how-to-use-title {
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 700;
    color: var(--glass-foreground-strong, var(--color-foreground, #2c2c2c));
    margin: 0;
    display: inline-block;
    position: relative;
  }

  .how-to-use-title::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: linear-gradient(
      90deg,
      var(--glass-highlight-color, var(--color-primary, #bf8a7a)),
      color-mix(in srgb, var(--glass-highlight-color, var(--color-primary, #bf8a7a)) 45%, transparent)
    );
    border-radius: 2px;
  }

  .how-to-use-subtitle {
    font-size: clamp(1.05rem, 2vw, 1.25rem);
    color: var(--glass-foreground-muted, var(--color-foreground, #2c2c2c));
    margin: 0 auto;
    max-width: 620px;
  }

  .how-to-use-steps {
    position: relative;
    display: grid;
    gap: clamp(2.5rem, 5vw, 3.5rem);
  }

  .how-to-step {
    display: flex;
    align-items: center;
    gap: clamp(2rem, 4vw, 3rem);
    position: relative;
    padding: clamp(1.8rem, 3.5vw, 2.4rem);
    border-radius: 24px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .how-to-step:hover {
    transform: translateY(-6px);
  }

  .step-reverse {
    flex-direction: row-reverse;
  }

  .step-normal {
    flex-direction: row;
  }

  .step-progress-wrapper {
    position: absolute;
    left: clamp(-2.25rem, -5vw, -1.75rem);
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    z-index: 5;
  }

  .step-reverse .step-progress-wrapper {
    left: auto;
    right: clamp(-2.25rem, -5vw, -1.75rem);
  }

  .step-number {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(
      135deg,
      var(--glass-highlight-color, var(--color-primary, #bf8a7a)),
      color-mix(in srgb, var(--glass-highlight-color, var(--color-primary, #bf8a7a)) 45%, transparent)
    );
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 16px
      color-mix(in srgb, var(--glass-highlight-color, var(--color-primary, #bf8a7a)) 32%, transparent);
    position: relative;
  }

  .step-number::before {
    content: '';
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    background: inherit;
    opacity: 0.3;
    animation: pulse 2s infinite;
  }

  .step-number-text {
    font-weight: 700;
    font-size: 1.5rem;
    color: var(--text-on-primary, #ffffff);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    position: relative;
    z-index: 1;
  }

  .step-progress-line {
    width: 4px;
    height: clamp(100px, 15vw, 140px);
    background: linear-gradient(
      180deg,
      var(--glass-highlight-color, var(--color-primary, #bf8a7a)),
      color-mix(in srgb, var(--glass-highlight-color, var(--color-primary, #bf8a7a)) 35%, transparent)
    );
    border-radius: 2px;
    position: relative;
    overflow: hidden;
  }

  .progress-line-fill {
    width: 100%;
    height: 0%;
    background: linear-gradient(
      180deg,
      var(--glass-foreground-strong, var(--color-foreground, #2c2c2c)),
      var(--glass-highlight-color, var(--color-primary, #bf8a7a))
    );
    border-radius: 2px;
    animation: fillProgress 3s ease-in-out infinite;
  }

  .progress-dots {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    align-items: center;
  }

  .progress-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: color-mix(in srgb, var(--text-on-primary, #ffffff) 80%, transparent);
    animation: dotPulse 2s infinite;
  }

  .progress-dot:nth-child(2) {
    animation-delay: 0.5s;
  }

  .progress-dot:nth-child(3) {
    animation-delay: 1s;
  }

  .step-content {
    display: flex;
    align-items: center;
    gap: clamp(2rem, 4vw, 3rem);
    width: 100%;
  }

  .step-reverse .step-content {
    flex-direction: row-reverse;
  }

  .step-image-wrapper {
    flex: 1 1 45%;
    position: relative;
  }

  .step-image-container {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 18px 40px rgba(17, 23, 34, 0.14);
  }

  .step-image {
    width: 100%;
    display: block;
    transition: transform 0.3s ease;
  }

  .step-image-container:hover .step-image {
    transform: scale(1.04);
  }

  .step-text-wrapper {
    flex: 1 1 55%;
    display: grid;
    gap: clamp(0.75rem, 2.5vw, 1.4rem);
  }

  .step-heading {
    font-size: clamp(1.6rem, 3vw, 2.2rem);
    font-weight: 600;
    color: var(--glass-foreground-strong, var(--color-foreground, #2c2c2c));
    margin: 0;
  }

  .step-description {
    color: var(--glass-foreground-muted, var(--color-foreground, #2c2c2c));
    line-height: 1.6;
    font-size: 1.05rem;
  }

  .step-tip {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: color-mix(in srgb, var(--glass-surface-color, rgba(255, 255, 255, 0.78)) 70%, transparent);
    border-left: 3px solid var(--glass-highlight-color, var(--color-primary, #bf8a7a));
    padding: 1rem 1.25rem;
    border-radius: 12px;
  }

  .tip-icon {
    font-size: 1.2rem;
  }

  .tip-text {
    margin: 0;
    color: var(--glass-foreground-strong, var(--color-foreground, #2c2c2c));
  }

  .step-duration {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 999px;
    background: color-mix(in srgb, var(--glass-surface-color, rgba(255, 255, 255, 0.78)) 60%, transparent);
  }

  .duration-text {
    color: var(--glass-foreground-strong, var(--color-foreground, #2c2c2c));
    font-weight: 600;
  }

  .step-decorations {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .decoration-circle {
    position: absolute;
    border-radius: 50%;
    background: color-mix(in srgb, var(--glass-highlight-color, var(--color-primary, #bf8a7a)) 14%, transparent);
    filter: blur(0px);
  }

  .decoration-1 {
    width: 140px;
    height: 140px;
    top: -40px;
    left: -40px;
  }

  .decoration-2 {
    width: 120px;
    height: 120px;
    bottom: -30px;
    right: 20%;
  }

  .decoration-line {
    position: absolute;
    top: 15%;
    right: -60px;
    width: 160px;
    height: 2px;
    background: color-mix(in srgb, var(--glass-highlight-color, var(--color-primary, #bf8a7a)) 18%, transparent);
    transform: rotate(12deg);
  }

  @media (max-width: 960px) {
    .step-progress-wrapper {
      display: none;
    }

    .how-to-step {
      flex-direction: column;
      text-align: center;
    }

    .step-reverse .step-content {
      flex-direction: column;
    }

    .step-content {
      flex-direction: column;
      gap: 1.5rem;
    }

    .step-text-wrapper {
      gap: 1rem;
    }
  }

  @media (max-width: 600px) {
    .how-to-use-section {
      width: 100%;
      margin-left: 0;
    }

    .step-duration {
      width: 100%;
      justify-content: center;
    }
  }

  @keyframes pulse {
    0%,
    100% {
      transform: scale(1);
      opacity: 0.3;
    }
    50% {
      transform: scale(1.1);
      opacity: 0.5;
    }
  }

  @keyframes fillProgress {
    0% {
      height: 0%;
    }
    50% {
      height: 100%;
    }
    100% {
      height: 0%;
    }
  }

  @keyframes dotPulse {
    0%,
    100% {
      transform: scale(0.8);
      opacity: 0.4;
    }
    50% {
      transform: scale(1);
      opacity: 1;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "How to Use",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Content"
    },
    {
      "type": "text",
      "id": "section_heading",
      "label": "Section Heading",
      "default": "How to Use"
    },
    {
      "type": "text",
      "id": "section_subheading",
      "label": "Section Subheading", 
      "default": "Follow these simple steps for perfect results"
    },
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color Scheme",
      "options": [
        {
          "value": "scheme-1",
          "label": "Scheme 1"
        },
        {
          "value": "scheme-2",
          "label": "Scheme 2"
        },
        {
          "value": "scheme-3",
          "label": "Scheme 3"
        },
      ],
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        {
          "value": "full-width",
          "label": "Full Width"
        },
        {
          "value": "page-width",
          "label": "Page Width"
        }
      ],
      "default": "full-width"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "section_header",
      "name": "Section Header",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Section Heading",
          "default": "How to Use"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Section Subheading",
          "default": "Follow these simple steps for perfect results"
        }
      ]
    },
    {
      "type": "step",
      "name": "Step",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Step Heading",
          "default": "Step Title"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Step Description",
          "default": "<p>Describe what the user should do in this step.</p>"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Step Image (Desktop)"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Step Image (Mobile)",
          "info": "Optional: Different image for mobile devices"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Placeholder Icon",
          "default": "üì∏",
          "info": "Emoji or icon to show when no image is uploaded"
        },
        {
          "type": "text",
          "id": "tip",
          "label": "Pro Tip",
          "info": "Optional tip or additional information"
        },
        {
          "type": "text",
          "id": "duration",
          "label": "Duration",
          "info": "Optional duration for this step (e.g., '2-3 minutes')"
        },
        {
          "type": "text",
          "id": "placeholder_title",
          "label": "Placeholder Title",
          "default": "Add Step Image",
          "info": "Title shown in placeholder when no image is uploaded"
        },
        {
          "type": "text",
          "id": "placeholder_creative",
          "label": "Placeholder Creative Description",
          "default": "Tutorial step showing beauty product application technique",
          "info": "Creative description for the placeholder image"
        },
        {
          "type": "text",
          "id": "placeholder_web_size",
          "label": "Web Size Recommendation",
          "default": "800√ó600px",
          "info": "Recommended size for desktop/web viewing"
        },
        {
          "type": "text",
          "id": "placeholder_mobile_size",
          "label": "Mobile Size Recommendation",
          "default": "600√ó400px",
          "info": "Recommended size for mobile viewing"
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "How to Use",
      "blocks": [
        {
          "type": "section_header",
          "settings": {
            "heading": "How to Use",
            "subheading": "Follow these simple steps for perfect results"
          }
        },
        {
          "type": "step",
          "settings": {
            "heading": "Step 1: Prepare",
            "text": "<p>Start by preparing your workspace and gathering all necessary materials.</p>",
            "icon": "üß¥",
            "tip": "Make sure your hands are clean before starting",
            "duration": "1 minute"
          }
        },
        {
          "type": "step",
          "settings": {
            "heading": "Step 2: Apply",
            "text": "<p>Apply the product gently and evenly across the target area.</p>",
            "icon": "‚ú®",
            "tip": "Use gentle circular motions for best results",
            "duration": "2-3 minutes"
          }
        },
        {
          "type": "step",
          "settings": {
            "heading": "Step 3: Finish",
            "text": "<p>Complete the process and enjoy your beautiful results!</p>",
            "icon": "üåü",
            "tip": "Wait for the product to fully absorb",
            "duration": "5 minutes"
          }
        }
      ],
      "settings": {
        "color_scheme": "scheme-1",
        "section_width": "full-width"
      }
    }
  ]
}
{% endschema %}
